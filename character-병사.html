<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>λ³‘μ‚¬μ ν–‰λ™</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main>
    <h1>λ³‘μ‚¬μ ν–‰λ™: μμ„2</h1>
    <p>Aμ κ³µκ²©μΌλ΅λ¶€ν„° Bλ¥Ό λ³΄νΈν•©λ‹λ‹¤. λ¨Όμ € κ³µκ²©μ(A)λ¥Ό μ„ νƒν•μ„Έμ”.</p>
    <div id="step1">
      <button onclick="selectAttacker('μ‹ λ°λ λΌ')">μ‹ λ°λ λΌ</button>
      <button onclick="selectAttacker('λλ¦¬')">λλ¦¬</button>
      <button onclick="selectAttacker('μ•¨λ¦¬μ‹μ•„')">μ•¨λ¦¬μ‹μ•„</button>
      <button onclick="selectAttacker('μλ¶“μ–΄λ¨Έλ‹')">μλ¶“μ–΄λ¨Έλ‹</button>
      <button onclick="selectAttacker('μ™•μ')">μ™•μ</button>
      <button onclick="skipAction1()">μ‹¤ν–‰ν•μ§€ μ•μ</button>
    </div>

    <div id="step2" style="display:none; margin-top: 20px;">
      <p>μ΄μ  λ³΄νΈν•  λ€μƒ(B)μ„ μ„ νƒν•μ„Έμ”.</p>
      <div id="protectorButtons"></div>
    </div>

    <div id="action2" style="display:none; margin-top: 30px;">
      <p>μ•„μ΄ν…μ„ νκ΄΄ν•μ‹κ² μµλ‹κΉ? (μ•„μ΄ν… μ΄λ¦„: μ² μ  ν)</p>
      <input type="text" id="itemInput" placeholder="μ•„μ΄ν… μ΄λ¦„ μ…λ ¥">
      <button onclick="saveActions()">μ•΅μ…2 μ €μ¥</button>
    </div>
  </main>

  <footer style="
    position: fixed;
    bottom: 40px;
    width: 100%;
    text-align: center;
    z-index: 1000;
  ">
    <button style="
      padding: 10px 20px;
      font-size: 16px;
      background-color: #ffefb0;
      border: 2px solid #999;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.2);
    " onclick="resetGame()">π”„ μ²μμΌλ΅ λλμ•„κ°€κΈ°</button>
  </footer>

  <script>
    let attacker = "";
    function selectAttacker(name) {
      attacker = name;
      document.getElementById("step1").style.display = "none";
      document.getElementById("step2").style.display = "block";

      const names = ["μ‹ λ°λ λΌ", "λλ¦¬", "μ•¨λ¦¬μ‹μ•„", "μλ¶“μ–΄λ¨Έλ‹", "λ³‘μ‚¬", "μ™•μ"];
      const targetArea = document.getElementById("protectorButtons");
      targetArea.innerHTML = "";

      names.forEach(name => {
        if (name !== attacker) {
          const btn = document.createElement("button");
          btn.textContent = name;
          btn.onclick = () => selectProtector(name);
          targetArea.appendChild(btn);
        }
      });
    }

    function skipAction1() {
      const gameState = JSON.parse(localStorage.getItem("gameState") || "{}");
      gameState.actions = gameState.actions || {};
      gameState.actions["λ³‘μ‚¬"] = gameState.actions["λ³‘μ‚¬"] || {};
      gameState.actions["λ³‘μ‚¬"].action1 = null;
      localStorage.setItem("gameState", JSON.stringify(gameState));

      document.getElementById("step1").style.display = "none";
      document.getElementById("action2").style.display = "block";
    }

    function selectProtector(name) {
      const gameState = JSON.parse(localStorage.getItem("gameState") || "{}");
      gameState.actions = gameState.actions || {};
      gameState.actions["λ³‘μ‚¬"] = gameState.actions["λ³‘μ‚¬"] || {};
      gameState.actions["λ³‘μ‚¬"].action1 = { attacker: attacker, target: name };
      localStorage.setItem("gameState", JSON.stringify(gameState));

      document.getElementById("step2").style.display = "none";
      document.getElementById("action2").style.display = "block";
    }

    function saveActions() {
      const item = document.getElementById("itemInput").value.trim();
      if (!item) {
        alert("μ•„μ΄ν… μ΄λ¦„μ„ μ…λ ¥ν•΄μ•Ό λ‹¤μμΌλ΅ μ§„ν–‰ν•  μ μμµλ‹λ‹¤.");
        return;
      }
      const gameState = JSON.parse(localStorage.getItem("gameState") || "{}");
      gameState.actions = gameState.actions || {};
      gameState.actions["λ³‘μ‚¬"] = gameState.actions["λ³‘μ‚¬"] || {};
      gameState.actions["λ³‘μ‚¬"].action2 = item;
      localStorage.setItem("gameState", JSON.stringify(gameState));

      const next = gameState.orderQueue?.shift();
      localStorage.setItem("gameState", JSON.stringify(gameState));
      if (gameState.orderQueue && gameState.orderQueue.length > 0) {
        window.location.href = `character-${gameState.orderQueue[0]}.html`;
      } else {
        window.location.href = "result.html";
      }
    }

    function resetGame() {
      localStorage.removeItem("gameState");
      localStorage.removeItem("voteResult");
      location.href = "character-μ™•μ.html";
    }
  </script>
</body>
</html>
