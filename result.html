<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê²Œì„ ê²°ê³¼</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main>
    <h1>ê²Œì„ ê²°ê³¼</h1>
    <p>ë²”ì¸ìœ¼ë¡œ ì§€ëª©ëœ ìºë¦­í„°ë¥¼ ì„ íƒí•˜ì„¸ìš”:</p>
    <div id="voteButtons">
      <button onclick="selectVote('ì‹ ë°ë ë¼')">ì‹ ë°ë ë¼</button>
      <button onclick="selectVote('ëŒë¦¬')">ëŒë¦¬</button>
      <button onclick="selectVote('ì•¨ë¦¬ì‹œì•„')">ì•¨ë¦¬ì‹œì•„</button>
      <button onclick="selectVote('ì˜ë¶“ì–´ë¨¸ë‹ˆ')">ì˜ë¶“ì–´ë¨¸ë‹ˆ</button>
      <button onclick="selectVote('ë³‘ì‚¬')">ë³‘ì‚¬</button>
      <button onclick="selectVote('ì™•ì')">ì™•ì</button>
    </div>

    <div id="resultSection" style="display:none; margin-top: 30px;">
      <p>ì„ íƒì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì—”ë”©ì„ í™•ì¸í•˜ì„¸ìš”.</p>
      <button onclick="goToEnding()">ì—”ë”© ë³´ê¸°</button>
    </div>
  </main>

  <footer style="
    position: fixed;
    bottom: 40px;
    width: 100%;
    text-align: center;
    z-index: 1000;
  ">
    <button style="
      padding: 10px 20px;
      font-size: 16px;
      background-color: #ffefb0;
      border: 2px solid #999;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.2);
    " onclick="resetGame()">ğŸ”„ ì²˜ìŒìœ¼ë¡œ ë˜ëŒì•„ê°€ê¸°</button>
  </footer>

  <script>
    function selectVote(name) {
      const voteMap = {
        "ì‹ ë°ë ë¼": "C",
        "ëŒë¦¬": "D",
        "ì•¨ë¦¬ì‹œì•„": "A",
        "ì˜ë¶“ì–´ë¨¸ë‹ˆ": "M",
        "ë³‘ì‚¬": "S",
        "ì™•ì": "P"
      };
      const code = voteMap[name];
      localStorage.setItem("voteResult", code);
      document.getElementById("voteButtons").style.display = "none";
      document.getElementById("resultSection").style.display = "block";
    }

    function goToEnding() {
      const gameState = JSON.parse(localStorage.getItem("gameState") || "{}");
      const vote = localStorage.getItem("voteResult") || "X";

      let first = "R"; // ì¢… ìš¸ë¦¼ ê¸°ë³¸ê°’
      let earliestBreaker = null;
      const breakCandidates = ["ì‹ ë°ë ë¼", "ëŒë¦¬", "ì•¨ë¦¬ì‹œì•„", "ì˜ë¶“ì–´ë¨¸ë‹ˆ", "ë³‘ì‚¬", "ì™•ì"];
      for (const name of breakCandidates) {
        if (gameState.actions?.[name]?.action2?.includes("ì² ì œ íœ")) {
          if (!earliestBreaker || gameState.order.indexOf(name) < gameState.order.indexOf(earliestBreaker)) {
            earliestBreaker = name;
          }
        }
      }
      if (earliestBreaker && ["ì‹ ë°ë ë¼", "ì•¨ë¦¬ì‹œì•„", "ë³‘ì‚¬"].includes(earliestBreaker)) {
        first = "B";
      }

      let third = "N";
      const target = gameState.actions?.["ì˜ë¶“ì–´ë¨¸ë‹ˆ"]?.action1;
      const item = gameState.actions?.["ì˜ë¶“ì–´ë¨¸ë‹ˆ"]?.action2;
      if (target && (item?.includes("ë¹—") || item?.includes("ê³¼ë„"))) {
        const protector = gameState.actions?.["ë³‘ì‚¬"]?.action1;
        if (protector?.attacker === "ì˜ë¶“ì–´ë¨¸ë‹ˆ" && protector?.target === target) {
          third = "G";
        } else {
          third = convertTarget(target);
        }
      }

      const endingCode = `${first}${vote}${third}`;
      window.location.href = `ending/${endingCode}.html`;
    }

    function convertTarget(name) {
      const map = {
        "ì‹ ë°ë ë¼": "C",
        "ëŒë¦¬": "D",
        "ì•¨ë¦¬ì‹œì•„": "A",
        "ì˜ë¶“ì–´ë¨¸ë‹ˆ": "M",
        "ë³‘ì‚¬": "S",
        "ì™•ì": "P"
      };
      return map[name] || "N";
    }

    function resetGame() {
      localStorage.removeItem("gameState");
      localStorage.removeItem("voteResult");
      location.href = "character-ì™•ì.html";
    }
  </script>
</body>
</html>
